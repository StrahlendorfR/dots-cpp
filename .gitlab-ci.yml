
image: pnxs/dots_devenv:2

variables:
    GIT_SUBMODULE_STRATEGY: recursive

build_ubuntu:
    stage: build
    script:
        - pwd
        - cmake -Bbuild -H.
        - make -Cbuild -j4
    artifacts:
        paths:
            - ./build/dots-cpp/lib/libdots.a
            - ./build/dots-cpp/bin/dotsd/dotsd
            - ./build/dots-cpp/bin/examples/testClient/testClient
            - ./build/dots-cpp/tests/dots-unittests

run_unittests:
    stage: test
    dependencies:
        - build_ubuntu
    script:
        - pwd
        - find
        - ./build/dots-cpp/tests/dots-unittests --gtest_output="xml:report.xml"
    artifacts:
        reports:
            junit:
                - report.xml